<!DOCTYPE html>
<html lang="en">

<head>
    <title>Goddess Anime Forums</title>
    <!-- Link Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Goddess Anime">
    <meta property="og:title" content="<%= forum.title %>">
    <meta property="og:description" content="<%= forum.shortDescription %>">
    <meta property="og:image"
        content="https://cdn.discordapp.com/attachments/1095920079205568532/1135812618410524702/Anime-Fox-Girls-Wallpaper-scaled.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="Goddess Anime Cards">
    <meta name="twitter:creator" content="<%= forum.creator.username %>">
    <meta name="twitter:card" content="summary_large_image">
    <meta content="#43B581" data-react-helmet="true" name="theme-color" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="<%= forum.shortDescription %>">
    <meta name="keywords"
        content="Shoob, Unfatal, Procs, Anime, Cards, Game, Kiyo, Indivoxy, HyperStar, Aqua, Konosuba, Watch anime online, Best anime series, Top anime movies, Free anime streaming, Popular anime characters, Japanese animation, Anime news, Anime reviews, Anime merchandise, Anime forums, Anime conventions, Cosplay costumes, Anime wallpapers, Anime blogs, Anime trailers, Anime subbed/dubbed, Anime recommendations, Anime memes, Anime fanart, Anime music, Discord bot, Anime bot, Card game bot, Anime card game, Trading card game, Collectible card game, Digital card game, Anime community, Anime social platform, Anime gaming, Anime culture, Otaku community, Manga, Anime characters, Anime episodes, Anime streaming, Anime OST, Anime trivia, Anime quiz, Anime quotes, Anime recommendations, Anime rankings, Anime events, Anime contests, Anime challenges, Anime role-playing, Anime discord server, Anime emojis, Anime reactions, Anime gifs, Anime fanfiction, Anime streaming services, Anime merchandise store, Anime figurines, Anime art books, Anime cosplay accessories, Anime conventions, Anime tournaments, Anime news updates, Anime discussion, Anime spoilers, Japanese anime, Anime voice actors, Anime voice actresses, Anime collaborations, Anime crossovers, Anime video games, Anime mobile games, Anime collectibles, Anime loot boxes, Anime virtual goods, Anime memes, Anime fan community, Anime fan clubs, Anime giveaways, Anime art contests, Anime fanart commissions, Anime music playlists, Anime AMVs, Anime karaoke, Anime cosplay tutorials, Anime fashion, Anime aesthetics, Anime character analysis, Anime lore, Anime world-building, Anime graphics, Anime videos, Anime podcasts, Anime watch parties, Anime voice chat, Anime memes discord, Anime bot commands, Anime bot features">
    <meta http-equiv="Content-Language" content="en">
    <meta name="robots" content="index, follow">
    <meta name="revisit-after" content="2 days">
    <style>
        /* Custom CSS styles go here */
        body {
            padding-top: 60px;
        }

        .navbar-brand {
            font-size: 24px;
        }

        .post-content {
            margin-top: 20px;
        }

        .post-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .post-meta {
            color: #777;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .post-meta .post-author {
            font-weight: bold;
        }

        .post-meta .post-date {
            font-style: italic;
        }

        .post-body {
            font-size: 1.1rem;
            line-height: 1.8;
        }

        /* Responsive adjustments */
        @media (max-width: 767px) {
            .post-title {
                font-size: 2rem;
            }

            .post-meta {
                font-size: 0.8rem;
            }

            .post-body {
                font-size: 1rem;
            }
        }

        /* Comments Section */
        .comments {
            margin-top: 30px;
        }

        .comment {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
        }

        .comment-author {
            font-weight: bold;
        }

        .comment-date {
            font-style: italic;
            color: #777;
        }

        .comment-text {
            margin-top: 10px;
        }

        /* Upvote and Downvote Buttons */
        .voting-buttons {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }

        .upvote-btn,
        .downvote-btn {
            cursor: pointer;
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .upvote-btn {
            color: #28a745;
        }

        .downvote-btn {
            color: #dc3545;
        }

        .separator {
            border-left: 1px solid #ccc;
            height: 20px;
            margin: 0 10px;
        }

        @keyframes skeleton-loader {

            0%,
            100% {
                background-position: -200% 50%;
            }

            50% {
                background-position: 200% 50%;
            }
        }

        /* Define the skeleton loader animation for the avatar */
        @keyframes skeleton-loader-avatar {

            0%,
            100% {
                background-position: -200% 50%;
            }

            50% {
                background-position: 200% 50%;
            }
        }

        /* Skeleton Loader for Comments */
        .skeleton-loader-comment {
            /* Set the background color to the color of the skeleton */
            background-color: #e0e0e0;
            /* Add some padding and margin for spacing */
            padding: 20px;
            /* Increase padding for height */
            margin-bottom: 30px;
            /* Make it wider */
            width: 100%;
            /* Increase margin for spacing between comments */
            /* Add the skeleton loader animation */
            animation: skeleton-loader 2s linear infinite;
            /* Changed duration to 1 second */
            /* Add a nice rounded border */
            border-radius: 8px;
            /* Increase border radius for a smoother appearance */
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8677814295169281"
        crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W7P4DXPXTW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-W7P4DXPXTW');
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>
    <!-- Navigation Bar -->
    <%- include ("../templates/forums/header.ejs") %>
        <%- include ("../templates/forums/toasts.ejs") %>

            <!-- Content -->
            <!-- Post Content Section -->
            </br>
            </br>
            <section class="post-content">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 offset-lg-2">
                            <!-- Post Title -->
                            <h1 class="post-title">
                                <%= forum.title %>
                            </h1>
                            <!-- Post Metadata (e.g., author, date) -->
                            <p class="post-meta">Posted by <span class="post-author"><a
                                        href="/user/<%= forum.creator.discordId %>" class="text-gray-dark"
                                        target="_blank"
                                        style="text-decoration: none; color: #6c757d !important;"><strong
                                            class="text-gray-dark">@<%= forum.creator.username %>
                                        </strong></a></span> on
                                <span class="post-date">
                                    <%= forum.createdAt %>
                                </span>
                                <% if (forum.locked) { %>
                                    <span class="badge bg-danger"> Locked</span>
                                <% } %>
                            </p>
                            <!-- Post Content -->
                            <div class="post-body">
                                <%- forum.description %>
                                    <!-- You can add more post content here -->

                                    <!-- <span class="voting-buttons">
                                        <i class="bi bi-caret-up-fill upvote-btn" id="up-btn"></i>
                                        <span class="upvote-count">0</span>
                                        <span class="separator"></span>
                                        <i class="bi bi-caret-down-fill downvote-btn" id="down-btn"></i>
                                        <span class="downvote-count">0</span>
                                    </span> -->

                                    <!-- Comments Section -->
                                    <h3 class="comments">Comments</h3>

                                    <!-- Add a comment -->
                                    <% if (forum.locked) { %>
                                        <div class="col-sm-6 col-md-6 col-lg-6" id="add-comment">
                                            <label for="comment" class="form-label">Add a comment</label>
                                            <input type="text" class="form-control" id="comment" placeholder="" value=""
                                                disabled>
                                            <div class="invalid-feedback">
                                                Please enter a comment.
                                            </div>
                                        </div>
                                        <% } else { %>
                                            <div class="col-sm-6 col-md-6 col-lg-6" id="add-comment">
                                                <label for="comment" class="form-label">Add a comment</label>
                                                <input type="text" class="form-control" id="comment" placeholder=""
                                                    value="" required>
                                                <div class="invalid-feedback">
                                                    Please enter a comment.
                                                </div>
                                            </div>
                                            <% } %>


                                                <div class="my-3 p-3 bg-body rounded shadow-sm" id="comments-container">
                                                    <% for (let i=0; i < forum.commentLength; i++) { %>
                                                        <div class="d-flex text-muted pt-3">
                                                            <div class="flex-shrink-0 me-2 rounded skeleton-loader-avatar"
                                                                width="32" height="32"></div>
                                                            <div
                                                                class="pb-3 mb-0 small lh-sm border-bottom skeleton-loader-comment">
                                                            </div>
                                                        </div>
                                                        <% } %>
                                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Link Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
            <!-- SweetAlert2 -->
            <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

            <%- include ("../templates/forums/footer.ejs") %>

                <script>
                    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
                    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
                </script>

                <script>
                    const commentsContainer = document.getElementById('comments-container');

                    // Get comments from the api
                    const getComments = async () => {
                        const res = await fetch('/cforums/comments/<%= forum.id %>');
                        const data = await res.json();

                        const comments = data.data;

                        // Add the comments to the comments container
                        commentsContainer.innerHTML = comments.join('');

                        // Add the event listeners to the upvote and downvote buttons
                    }

                    // Call the async function inside a wrapper function
                    const loadComments = async () => {
                        try {
                            await getComments();
                        } catch (error) {
                            console.error('Error fetching comments:', error);
                        }
                    };

                    // Call the wrapper function
                    loadComments();
                </script>
                <script>
                    const searchBox = document.querySelector('#search-box');

                    searchBox.addEventListener('keyup', (e) => {
                        const searchQuery = e.target.value.toLowerCase();
                        if (e.keyCode === 13) {
                            window.location.href = `/forums?q=${searchQuery}`;
                        }
                    });
                </script>

                <script>
                    const commentTemplate = `<div class="d-flex text-muted pt-3">
        <img src="<avatar>" alt="" class="flex-shrink-0 me-2 rounded" width="32" height="32">
  
        <p class="pb-3 mb-0 small lh-sm border-bottom">
          <a href="<link>" class="d-block fw-bold text-gray-dark" target="_blank" style="text-decoration: none; color: #6c757d !important;"><strong class="d-block text-gray-dark">@<username></strong></a>
            <comment>
        </p>
      </div>`;

                    const commentInput = document.getElementById('comment');
                    const addComment = document.getElementById('add-comment');

                    // Add a comment
                    commentInput.addEventListener('keyup', (e) => {
                        if (e.keyCode === 13) {
                            const comment = e.target.value;

                            if (comment.length > 0) {
                                const commentData = {
                                    comment: comment
                                };

                                fetch(`/cforums/comment`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        comment: commentData.comment,
                                        id: '<%= forum.id %>'
                                    })
                                })
                                    .then(res => res.json())
                                    .then(data => {
                                        if (data.error != true) {
                                            const comment = commentData.comment;

                                            const commentHTML = commentTemplate
                                                .replace('<avatar>', data.comment.avatar)
                                                .replace('<link>', data.comment.link)
                                                .replace('<username>', data.comment.username)
                                                .replace('<comment>', comment);

                                            commentsContainer.insertAdjacentHTML('afterbegin', commentHTML);

                                            commentInput.value = '';
                                        } else {
                                            const errorToast = new bootstrap.Toast(document.getElementById('errortoast'));
                                            const errorToastBody = document.getElementById('errortoasttext');

                                            errorToastBody.innerHTML = data.error;
                                            errorToast.show();
                                        }
                                    })
                                    .catch(err => {
                                        console.error('Error adding comment:', err);
                                    });
                            }
                        }
                    });

                </script>
</body>

</html>